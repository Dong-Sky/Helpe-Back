# 功能流程文档

## 注册用户功能流程
- 客户端请求服务端, 带发送email字段,
- 服务端根据请求对email进行校验, 如果符合注册, 就发送验证邮件(邮件校验码有效期是2个小时), 写入注册临时表, 邮件和验证码,有效期是2个小时, 里面有时间戳字段, 如果客户端重复发送验证码, 需要在一个接口里不同的参数请求.
- 客户端填写验证邮件内容, 往服务端请求
- 服务端对验证码进行校验, 如果通过, 返回正常, 客户端跳到下一步
- 客户端输入注册信息 username,  password , 显示用户协议同意后, 提交用户信息的同时, 也提交校验码,提交注册信息, 插入用户表和登录表(使用事务方式写入),通知客户端
- 客户端显示注册成功


## 用户登录流程
### 常规用户登录
- 客户端输入用户名和密码, 请求服务端, email, password, type=1
- 服务端对用户名和密码进行验证, 如果通过,返回token,如果不通过, 返回错误信息
```$xslt
验证流程: 验证email和密码的准确性, 通过后, 重置 user 表的 access token. 对已经有的token 进行 delete 操作, 然后更新数据, 提示登录成功.
```

### 第三方用户登录:
- 客户端获取到 access_token 请求到服务端验证
- 服务端用access_token 到 facebook 验证用户信息, 如果通过,则需要插入用户表和登录表, 如果不通过, 则返回报错
```$xslt
注意点: 插入用户表和登录表的时候, 需要使用事务方式. 获取用户信息时, 保存相关的字段到用户信息表. 
```



## 用户信息
### 获取用户信息:
- 客户端根据用户id 和 token 获取用户信息.
- 服务端对请求进行校验, 如果通过, 返回用户信息, 如果不通过, 返回错误信息

### 修改用户信息:
- 客户端请求 用户信息和 token
- 服务端对请求进行校验, 如果通过, 进行保存, 否则返回错误信息
```$xslt
注意点: 客户端需要保存用户信息中有头像图片, 需要保存到 OSS 中
```


### 修改密码:
- 客户端请求用户老密码, 新密码 和 token
- 服务端对请求验证, 对老密码进行校验, 是否一致, 验证通过, 返回直接保存到新密码成功, 返回成功, 否则, 返回错误信息

### 重置密码: 重置密码的时候是不需要验证的, 只能普通的登录用户可以重置密码,第三方账户是不能重置密码的.
- 发送重置的邮件的申请, 通过后台发送重置邮件, 重置邮件有效期是2个小时有效期
- 填入验证码,  和新密码, 确认密码,然后提交验证码, 邮箱和密码
```$xslt
第三方facebook登录的数据,保存的数据是fbid,不保存邮件地址 facebookid 的nickname 保存的地址是邮件相关.
```

### 更改用户头像:
- 用户上报头像信息, 保存到本地,并保存到 oss 存储中, 返回保存的状态.


## 举报功能
服务和求助的举报, 选择举报类型, 然后提交, 提交后服务端根据举报的类型, 
服务和求助的状态字段, 进行处理. 更改状态到 下架状态.
后台管理功能, 可以服务和求助的状态, 并记录下操作日志

评论举报 选择原因提交后, 进行默认处理

举报的状态, 1系统处理, 2人工处理, 0默认状态


## 用户权限设置
用户权限的设计, 区分为登录限制(login), 发帖限制(post), 评论限制(comment), 购买限制(buy), 支付限制(pay), 权限有个有效期, 区分为长期, 和某个日期
默认是就限制的日期, 默认是不限制的, 如果权限且设置了时间, 判断时间的有效性, 是否需要做特殊处理



























